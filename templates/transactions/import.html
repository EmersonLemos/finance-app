{% extends "base.html" %}
{% block title %}Importar transações (CSV){% endblock %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="h4 mb-0">
    <i class="fa-solid fa-file-import me-1"></i> Importar transações (CSV)
  </h2>

  <a href="{{ url_for('transactions.list_transactions') }}" class="btn btn-outline-secondary btn-sm">
    <i class="fa-solid fa-arrow-left me-1"></i> Voltar
  </a>
</div>

<div class="card shadow-sm">
  <div class="card-body">

    <div class="alert alert-info py-2 mb-3">
      O CSV precisa ter o cabeçalho:
      <code>data,descricao,valor,tipo,categoria,conta</code>
    </div>

    <form
      id="csvImportForm"
      action="{{ url_for('transactions.import_transactions') }}"
      method="post"
      enctype="multipart/form-data"
      class="d-flex flex-column gap-2"
    >

      <!-- Input escondido (pra não aparecer "Escolher ficheiro") -->
      <input type="file" name="file" id="csvFile" accept=".csv" class="d-none" required>

      <label class="form-label mb-1">Arquivo CSV</label>

      <div class="d-flex flex-wrap gap-2 align-items-center">
        <button type="button" class="btn btn-outline-primary btn-sm" id="btnPickCsv">
          <i class="fa-solid fa-folder-open me-1"></i> Escolher CSV
        </button>

        <span id="csvFileName" class="text-muted small">
          Nenhum arquivo selecionado
        </span>
      </div>

      <div class="d-flex gap-2 mt-2">
        <button type="submit" class="btn btn-primary btn-sm" id="btnImport" disabled>
          <i class="fa-solid fa-upload me-1"></i> Importar
        </button>

        <button type="button" class="btn btn-outline-secondary btn-sm" id="btnClear" disabled>
          Limpar
        </button>
      </div>

    </form>
  </div>
</div>

<script>
(function () {
  const fileInput = document.getElementById("csvFile");
  const btnPick = document.getElementById("btnPickCsv");
  const btnImport = document.getElementById("btnImport");
  const btnClear = document.getElementById("btnClear");
  const fileName = document.getElementById("csvFileName");

  if (!fileInput || !btnPick || !btnImport || !btnClear || !fileName) return;

  btnPick.addEventListener("click", () => fileInput.click());

  fileInput.addEventListener("change", () => {
    if (fileInput.files && fileInput.files.length > 0) {
      fileName.textContent = fileInput.files[0].name;
      btnImport.disabled = false;
      btnClear.disabled = false;
    } else {
      fileName.textContent = "Nenhum arquivo selecionado";
      btnImport.disabled = true;
      btnClear.disabled = true;
    }
  });

  btnClear.addEventListener("click", () => {
    fileInput.value = "";
    fileName.textContent = "Nenhum arquivo selecionado";
    btnImport.disabled = true;
    btnClear.disabled = true;
  });
})();
</script>

{% endblock %}
